query_adclient_summary_wap;select a.ad_client_type as ad_client_type,a.ad_type as ad_type,sum(a.impressions) as impressions,sum(clicks) as clicks,count(distinct(a.ipaddress)) as requests_unique_visitors,((sum(a.clicks)/sum(a.impressions))*100) as ctr,((sum(((a.cost*p.percentage)/100))/sum(a.impressions))*1000) as ecpm,(sum((a.cost*p.percentage)/100)) as revenue,publisher_name as pub_name,app_name as adclient_name,p.id as pub_id,a.client_id as client_id,hour(delivery_time) as delivery_hour,date(delivery_time) as delivery_date from adsdeliveries a, publishers p, adclients adc where (ad_client_type = 'WAP' or ad_client_type='wap')  and a.client_id=adc.id and adc.publisher_id=p.id and delivery_time>=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':00:00') and delivery_time<=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':59:59') group by  delivery_date, delivery_hour, a.client_id order by null
query_adclient_summary_sms;select a.ad_client_type as ad_client_type,a.ad_type as ad_type,sum(a.impressions) as impressions ,count(distinct(a.ipaddress)) as requests_unique_visitors,((sum(p.sms_charge)/sum(a.impressions))*1000) as ecpm,sum(p.sms_charge) as revenue,publisher_name as pub_name, app_name as adclient_name,p.id as pub_id,a.client_id as client_id, hour(a.delivery_time) as delivery_hour,date(a.delivery_time) as delivery_date from adsdeliveries a, publishers p, adclients adc where (ad_client_type = 'SMS' and ad_client_type = 'sms')  and a.client_id=adc.id and adc.publisher_id=p.id and delivery_time>=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':00:00') and delivery_time<=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':59:59') group by  delivery_date, delivery_hour, a.client_id order by null
query_handset;select  a.device_name as vendor,count(a.device_name) as requests,adc.publisher_id as pub_id,a.client_id as client_id, hour(a.delivery_time) as delivery_hour,date(a.delivery_time) as delivery_date from adsdeliveries a, adclients adc where  a.client_id=adc.id and delivery_time>=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':00:00') and delivery_time<=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':59:59') group by vendor,delivery_date,delivery_hour,a.client_id order by null
query_unique_visitor;select  a.ipaddress as ipaddress,count(a.ipaddress) as requests,a.country_code as country_code,a.country as country_name,adc.publisher_id as pub_id,a.client_id as client_id, a.ad_client_type as ad_client_type,hour(a.delivery_time) as delivery_hour,date(a.delivery_time) as delivery_date from adsdeliveries a, adclients adc where  a.client_id=adc.id and delivery_time>=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':00:00') and delivery_time<=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':59:59') group by ipaddress,delivery_date, delivery_hour, client_id order by null
query_url;select  a.url as url,count(a.url) as requests,adc.publisher_id as pub_id,a.client_id as client_id, hour(a.delivery_time) as delivery_hour,date(a.delivery_time) as delivery_date from adsdeliveries a, adclients adc where a.client_id=adc.id  and delivery_time>=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':00:00') and delivery_time<=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':59:59') group by url,delivery_date, delivery_hour, client_id order by null
query_geolocation;select  a.continent_code as continent_code,count(a.continent_code) as requests,a.country_code as country_code,a.continent_name as continent_name,a.country as country_name,a.region as region_name,adc.publisher_id as pub_id,a.client_id as client_id,a.ad_client_type as ad_client_type, hour(a.delivery_time) as delivery_hour,date(a.delivery_time) as delivery_date from adsdeliveries a, adclients adc where  a.client_id=adc.id and delivery_time>=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':00:00') and delivery_time<=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':59:59') group by continent_code,country_code,region_name,delivery_date, delivery_hour, client_id order by null
query_channel;select SUBSTRING(a.channels, num.n, locate(',',concat(a.channels,','),num.n) - num.n) AS channel_tar,count(a.channels) as requests,adc.publisher_id as pub_id,a.client_id as client_id, a.ad_client_type as ad_client_type,hour(a.delivery_time) as delivery_hour,date(a.delivery_time) as delivery_date from adsdeliveries a CROSS JOIN numbers num, adclients adc where a.client_id=adc.id and delivery_time>=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':00:00') and delivery_time<=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':59:59') and SUBSTRING(concat(',',a.channels), num.n, 1) = ',' AND num.n < length(a.channels) + 1 group by channel_tar, delivery_date, delivery_hour, client_id order by null
query_keyword;select  SUBSTRING(a.keywords, num.n, locate(',',concat(a.keywords,','),num.n) - num.n) AS keyword,count(a.keywords) as requests,adc.publisher_id as pub_id,a.client_id as client_id, a.ad_client_type as ad_client_type,hour(a.delivery_time) as delivery_hour,date(a.delivery_time) as delivery_date from adsdeliveries a CROSS JOIN numbers num, adclients adc where a.client_id=adc.id  and delivery_time>=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':00:00') and delivery_time<=concat(if(hour(curTime())='00' or hour(curTime())='01',DATE_ADD(CURDATE(), INTERVAL -1 DAY),curDate()),' ',if(hour(curTime())='00',22,if(hour(curTime())='01',23,hour(subtime(curTime(),'0 2:0:0')))),':59:59') and SUBSTRING(concat(',',a.keywords), num.n, 1) = ',' AND num.n < length(a.keywords) + 1 group by keyword,delivery_date,delivery_hour,a.client_id order by null
