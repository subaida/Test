<?xml version="1.0" encoding="iso-8859-1"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>FusionMaps Documentation</title>
<link rel="stylesheet" type="text/css" href="Style.css" />
</head>

<body>
<table width="98%" border="0" cellspacing="0" cellpadding="3" align="center">
  <tr> 
    <td><h2 class="pageHeader">FusionMaps with ASP.NET (C#) &gt; Using Data from Form </h2></td>
  </tr>
  
  <tr>
    <td valign="top" class="text">In this section, we will see how to generate a FusionMap using data collected from Form. </td>
  </tr>
  <tr>
    <td valign="top" class="text">&nbsp;</td>
  </tr>
  <tr>
    <td valign="top" class="text"><p>For the sake of demo, let us take the example of a fictional company that wants to plot the world-wide sales report for a particular day on a map. </p>
    <p>The example first loads a page that has a form to accept data for all the continents. Here, we have put some default data which can be modified as per user's wish.  This data will be submitted  to another ASP.NET (C#) page. This page will acquire the data   and plot it on the map. For the sake of simplicity, we wouldn't do any   processing or checking on this data. However, your real life applications might process data   before presenting it on the map. </p></td>
  </tr>
  <tr>
    <td valign="top" class="text">&nbsp;</td>
  </tr>
  <tr>
    <td valign="top" class="highlightBlock">Before proceeding further, we recommend to go through the section &quot;How to use FusionMaps&quot; for a better insight. </td>
  </tr>
  <tr>
    <td valign="top" class="text">&nbsp;</td>
  </tr>
  <tr>
    <td valign="top" class="highlightBlock">The code examples contained in this page are present in   <span class="codeInline">Download Package &gt; Code &gt; FusionMapCS &gt; FormBased</span> folder. </td>
  </tr>
  <tr>
    <td valign="top" class="text">&nbsp;</td>
  </tr>
  <tr>
    <td valign="top" class="header">Building the Form </td>
  </tr>
  <tr>
    <td valign="top" class="text">The form is contained in the<span class="codeInline"> Default.aspx</span> page. Shown below is a snapshot: </td>
  </tr>
  <tr>
    <td valign="top" class="text">&nbsp;</td>
  </tr>
  <tr>
    <td valign="top" class="text"><img src="Images/CodeASPForm1.jpg" width="474" height="377" class="imageBorder" /></td>
  </tr>
  <tr>
    <td valign="top" class="text">&nbsp;</td>
  </tr>
  <tr>
    <td valign="top" class="text">This is a very simple form which submits to <span class="codeInline">FormSubmit.aspx</span>. </td>
  </tr>
  <tr>
    <td valign="top" class="text">&nbsp;</td>
  </tr>
  <tr class="codeBlock">
    <td valign="top" ><p>&lt;%@ Page Language=&quot;C#&quot; AutoEventWireup=&quot;true&quot; CodeFile=&quot;FormSubmit.aspx.cs&quot; Inherits=&quot;FormBased_FormSubmit&quot; %&gt;<br />
      &lt;html&gt;<br />
      &nbsp; &lt;head&gt;<br />
  &nbsp;&nbsp;&nbsp;&nbsp; &lt;title&gt;FusionMaps v3 - Form Based Example&lt;/title&gt;<br />
 &nbsp;&nbsp;&nbsp;&nbsp; &lt;script language=&quot;Javascript&quot; src=&quot;../JSClass/FusionMaps.js&quot;&gt;&lt;/script&gt;<br />
 &nbsp; &lt;/head&gt;<br />
&nbsp; &lt;body&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;form id='form1' name='form1' method='post' runat=&quot;server&quot;&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;% <span class="codeComment">// Show the Map</span> %&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>&lt;asp:Literal ID=&quot;FusionMapsContainer&quot; runat=&quot;server&quot;/&gt;</strong><br />
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;<br />
&nbsp;&nbsp;&nbsp; &lt;/form&gt;<br />
&nbsp; &lt;/body&gt;<br />
&lt;/html&gt;<br />
        </p>
    </td>
  </tr>
  <tr>
    <td valign="top" class="text">&nbsp;</td>
  </tr>
  <tr>
    <td valign="top" class="header">Requesting the data and Creating the Map </td>
  </tr>
  <tr>
    <td valign="top" class="text">The work of requesting the data from submitted form and creating the map is   done in <span class="codeInline">FormSubmit.aspx.cs</span>, present in the same folder. It   contains the following code: </td>
  </tr>
  <tr>
    <td valign="top" class="codeBlock"><p>using System;<br />
      using System.Data;<br />
      using System.Configuration;<br />
      using System.Collections;<br />
      using System.Web;<br />
      using System.Web.Security;<br />
      using System.Web.UI;<br />
      using System.Web.UI.WebControls;<br />
      using System.Web.UI.WebControls.WebParts;<br />
      using System.Web.UI.HtmlControls;<br />
      using System.Text;<br />
      <span class="codeComment">// Using FusionMaps.dll </span><br />
      using InfoSoftGlobal;</p>
      <p>public partial class FormBased_FormSubmit : System.Web.UI.Page<br />
        {<br />
        <span class="codeComment">&nbsp;&nbsp; /// &lt;summary&gt;<br />
        &nbsp;&nbsp; /// This program takes Maps Request value and convert into an Array <br />
        &nbsp;&nbsp; /// finally convert the data into FusionMaps dataXML to render map<br />
        &nbsp;&nbsp; /// &lt;/summary&gt;</span><br />
        <span class="codeComment">&nbsp;&nbsp; </span>protected void Page_Load(object sender, EventArgs e)<br />
        <span class="codeComment">&nbsp;&nbsp; </span>{<br />
        <span class="codeComment">&nbsp;&nbsp; &nbsp;&nbsp; // Define dataArray Two dimension string Array element. 1st column take <br />
        &nbsp;&nbsp; &nbsp;&nbsp; // map internal id and 2nd column take Value.</span><br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>string[,] dataArray = new string[8, 2];</p>
      <p class="codeComment"> &nbsp;&nbsp; &nbsp;&nbsp; // Array data assigned from Context object Items<br />
        &nbsp;&nbsp; &nbsp;&nbsp; // In this example, we're directly showing this data back on Map.<br />
        &nbsp;&nbsp; &nbsp;&nbsp; // In your apps, you can do the required processing and then show the <br />
      &nbsp;&nbsp; &nbsp;&nbsp; // relevant data only.</p>
      <p> <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>dataArray[0, 0] = &quot;01&quot;; dataArray[0, 1] = Context.Items[&quot;AS1&quot;].ToString();<br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>dataArray[1, 0] = &quot;02&quot;; dataArray[1, 1] = Context.Items[&quot;EU&quot;].ToString();<br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>dataArray[2, 0] = &quot;03&quot;; dataArray[2, 1] = Context.Items[&quot;AF&quot;].ToString();<br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>dataArray[3, 0] = &quot;04&quot;; dataArray[3, 1] = Context.Items[&quot;NA&quot;].ToString();<br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>dataArray[4, 0] = &quot;05&quot;; dataArray[4, 1] = Context.Items[&quot;SA&quot;].ToString();<br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>dataArray[5, 0] = &quot;06&quot;; dataArray[5, 1] = Context.Items[&quot;CA&quot;].ToString();<br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>dataArray[6, 0] = &quot;07&quot;; dataArray[6, 1] = Context.Items[&quot;OC&quot;].ToString();<br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>dataArray[7, 0] = &quot;08&quot;; dataArray[7, 1] = Context.Items[&quot;ME1&quot;].ToString();</p>
      <p> <span class="codeComment">&nbsp;&nbsp; &nbsp;&nbsp; /*<br />
        &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; Now that we've the data in variables, we need to convert this into XML.<br />
        &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; The simplest method to convert data into XML is using string concatenation. <br />
        &nbsp;&nbsp; &nbsp;&nbsp; */</span><br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>StringBuilder strXML = new StringBuilder();</p>
      <p> <span class="codeComment">&nbsp;&nbsp; &nbsp;&nbsp; //Initialize &lt;map&gt; element</span><br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>strXML.Append(&quot;&lt;map borderColor='FFFFFF' connectorColor='000000' fillAlpha='70' hoverColor='FFFFFF' showBevel='0'&gt;&quot;);</p>
      <p> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="codeComment">// Set colorRange's Maximum and minimum value for displaying color range</span><br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>strXML.Append(&quot;&lt;colorRange&gt;&quot;);<br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>strXML.Append(&quot;&lt;color minValue='1' maxValue='350' displayValue='Population - 1 to 350' color='CC0001' /&gt;&quot;);<br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>strXML.Append(&quot;&lt;color minValue='350' maxValue='500' displayValue='Population - 350 to 500' color='FFD33A' /&gt;&quot;);<br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>strXML.Append(&quot;&lt;color minValue='500' maxValue='700' displayValue='Population - 500 to 700' color='069F06' /&gt;&quot;);<br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>strXML.Append(&quot;&lt;color minValue='700' maxValue='1000' displayValue='Population - 700 or above' color='ABF456' /&gt;&quot;);<br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>strXML.Append(&quot;&lt;/colorRange&gt;&lt;data&gt;&quot;);<br />
      </p>
      <p> <span class="codeComment">&nbsp;&nbsp; &nbsp;&nbsp; // Fetch Data from array </span><br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>for (int i = 0; i &lt; dataArray.GetLength(0); i++)<br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>{<br />
        <span class="codeComment">&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; // Set each map &lt;entity&gt; id and value</span><br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>strXML.AppendFormat(&quot;&lt;entity id='{0}' value='{1}' /&gt;&quot;, dataArray[i, 0], dataArray[i, 1]);</p>
      <p> <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>}</p>
      <p> <span class="codeComment">&nbsp;&nbsp; &nbsp;&nbsp; // Close  &lt;data&gt; element</span><br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>strXML.Append(&quot;&lt;/data&gt;&quot;);</p>
      <p> <span class="codeComment">&nbsp;&nbsp; &nbsp;&nbsp; // Add Style on map</span><br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>strXML.Append(&quot;&lt;styles&gt;&lt;definition&gt;&lt;style type='animation' name='animX' param='_xscale' start='0' duration='1' /&gt;&lt;style type='animation' name='animY' param='_yscale' start='0' duration='1' /&gt;&quot;);<br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>strXML.Append(&quot;&lt;/definition&gt;&lt;application&gt;&lt;apply toObject='PLOT' styles='animX,animY' /&gt;&lt;/application&gt;&lt;/styles&gt;&quot;);</p>
      <p> <span class="codeComment">&nbsp;&nbsp; &nbsp;&nbsp; // Close &lt;map&gt; element</span><br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>strXML.Append(&quot;&lt;/map&gt;&quot;);</p>
      <p> <span class="codeComment">&nbsp;&nbsp; &nbsp;&nbsp; // Create Map embedding HTML with data contained in strXML <br />
        &nbsp;&nbsp; &nbsp;&nbsp; // We use FusionMaps class of InfoSoftGlobal namespace (FusionMaps.dll in BIN folder)<br />
        &nbsp;&nbsp; &nbsp;&nbsp; // RenderMap() generates the necessary HTML needed to render the map</span><br />
        <span class="codeComment">&nbsp;&nbsp; &nbsp;&nbsp; </span>string mapHTML=<strong>FusionMaps.RenderMap(&quot;../Maps/FCMap_World8.swf&quot;, &quot;&quot;, strXML.ToString(), &quot;mapid&quot;, &quot;600&quot;, &quot;400&quot;, false, false);</strong></p>
      <p> <span class="codeComment">&nbsp;&nbsp; &nbsp;&nbsp; //embed the chart rendered as HTML into Literal -  FusionMapsContainer</span><br />
        <span class="codeComment">&nbsp;&nbsp; </span><span class="codeComment">&nbsp;&nbsp; </span>FusionMapsContainer.Text = mapHTML;<br />
  <br />
        <span class="codeComment">&nbsp;&nbsp; </span>}<br />
      </p>
      <p>}<br />
      </p></td>
  </tr>
  <tr>
      <td valign="top" class="text">&nbsp;</td>
  </tr>
  <tr>
      <td valign="top" class="text">Like the first Example - Using dataXML Method, we call the <span class="codeInline">showMap()</span> function to load and render the map. Let us now discuss the steps involved in this new <span class="codeInline">showMap()</span> function. </td>
  </tr>
  <tr>
    <td valign="top" class="text">&nbsp;</td>
  </tr>
  <tr>
    <td valign="top" class="header">Steps involved in this code </td>
  </tr>
  <tr>
    <td valign="top" class="text">As you can see in the above code, we're doing the following:</td>
  </tr>
  <tr>
    <td valign="top" class="text"><ul>
      <li>Requesting data from the submitted form and storing it in local array - <span class="codeInline">dataArray</span>. </li>
      <li>Creating an XML data document using string concatenation and storing it in <span class="codeInline">strXML</span> variable by iterating through <span class="codeInline">dataArray</span>. </li>
      <li>Using <span class="codeInline">InfosoftGlobal </span>assembly's <span class="codeInline">FusionMaps </span>class's <span class="codeInline">renderMap()</span>  function to pass <span class="codeInline">strXML</span> as the <span class="codeInline">dataXML</span> for the map and and render it in literal control - FusionMapsContainer. </li>
    </ul></td>
  </tr>
  <tr>
    <td valign="top" class="text">&nbsp;</td>
  </tr>
  <tr>
    <td valign="top" class="text">Below is the snapshot of the map that we get here. </td>
  </tr>
  
  <tr>
    <td valign="top" class="text"><img src="Images/CodeASPForm2.jpg" width="724" height="419" class="imageBorder" /></td>
  </tr>
  
  <tr> 
    <td valign="top" class="text">&nbsp;</td>
  </tr>
</table>
</body>
</html>
